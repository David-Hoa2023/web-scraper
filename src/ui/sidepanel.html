<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8">
  <title>Scraper Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo-area">
        <div class="logo-icon-wrapper">
          <span class="material-symbols-outlined logo-icon">terminal</span>
        </div>
        <div>
          <h1 class="logo-text">Scraper Pro</h1>
          <p class="logo-subtitle">Developer Tools</p>
        </div>
      </div>

      <!-- Master ON/OFF Toggle -->
      <div class="extension-toggle-container">
        <div class="extension-toggle-row">
          <span class="extension-status" id="extension-status">Active</span>
          <label class="switch">
            <input type="checkbox" id="extension-enabled" checked>
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <nav class="nav-menu">
        <button class="nav-item active" data-tab="dashboard" id="nav-dashboard">
          <span class="material-symbols-outlined">dashboard</span>
          <span>Dashboard</span>
        </button>
        <button class="nav-item" data-tab="match" id="nav-match">
          <span class="material-symbols-outlined">hub</span>
          <span>Match Strategy</span>
        </button>
        <button class="nav-item" data-tab="extract" id="nav-extract">
          <span class="material-symbols-outlined">database</span>
          <span>Extraction</span>
        </button>
        <button class="nav-item" data-tab="history" id="nav-history">
          <span class="material-symbols-outlined">history</span>
          <span>History</span>
        </button>
        <button class="nav-item" data-tab="settings" id="nav-settings">
          <span class="material-symbols-outlined">settings</span>
          <span>Settings</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="usage-box">
          <p class="usage-label">Usage Limit</p>
          <div class="usage-bar">
            <div class="usage-fill" id="usage-fill" style="width: 65%"></div>
          </div>
          <p class="usage-text"><span id="usage-current">650</span> / <span id="usage-max">1000</span> requests</p>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="content-area custom-scrollbar">

      <!-- Dashboard Tab -->
      <div id="tab-dashboard" class="tab-pane active">
        <header class="dashboard-header">
          <div>
            <h2>Dashboard</h2>
            <p class="subtitle">Monitor and manage your scraping tasks.</p>
          </div>
          <button class="btn-secondary" id="create-task-btn">
            <span class="material-symbols-outlined" style="font-size: 16px; margin-right: 4px;">add</span>
            New Task
          </button>
        </header>

        <div class="stats-overview stats-3col">
          <div class="stat-card">
            <div class="stat-header">
              <span class="stat-label">Total Tasks</span>
              <span class="material-symbols-outlined stat-icon">assignment</span>
            </div>
            <span class="stat-value" id="total-tasks">0</span>
            <span class="stat-trend">
              <span class="material-symbols-outlined" style="font-size: 12px;">trending_up</span>
              <span id="tasks-trend">+0 this week</span>
            </span>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <span class="stat-label">Success Rate</span>
              <span class="material-symbols-outlined stat-icon">check_circle</span>
            </div>
            <span class="stat-value" id="success-rate">0%</span>
            <span class="stat-trend">
              <span class="material-symbols-outlined" style="font-size: 12px;">trending_up</span>
              <span id="success-trend">+0%</span>
            </span>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <span class="stat-label">Items Collected</span>
              <span class="material-symbols-outlined stat-icon">database</span>
            </div>
            <span class="stat-value" id="items-count">0</span>
            <span class="stat-trend">
              <span class="material-symbols-outlined" style="font-size: 12px;">trending_up</span>
              <span id="items-trend">+0 today</span>
            </span>
          </div>
        </div>

        <div class="hero-actions">
          <button id="main-action-btn" class="btn-primary">
            <span class="material-symbols-outlined">play_arrow</span>
            Start Scanning
          </button>
        </div>

        <div class="status-badge" id="status-badge">
          <span class="dot active" id="status-dot"></span>
          <span id="status-text">System Ready</span>
        </div>

        <div class="log-section" style="margin-top: 16px;">
          <div class="log-header">
            <h3>Recent Activity</h3>
            <button id="clear-log-btn" class="btn-text">Clear</button>
          </div>
          <div class="log-list custom-scrollbar" id="activity-log">
            <div class="log-item">
              <span class="time">--:--</span>
              <span class="msg">Waiting for activity...</span>
            </div>
          </div>
        </div>

        <!-- Live Preview Section -->
        <div class="option-card" style="margin-top: 16px;">
          <div class="preview-header">
            <h3>Latest Capture</h3>
            <button id="toggle-preview-mode" class="btn-text" title="Toggle view mode">
              <span class="material-symbols-outlined" style="font-size: 16px;">view_list</span>
            </button>
          </div>
          <!-- Visual preview cards -->
          <div id="preview-cards" class="preview-cards custom-scrollbar">
            <div class="preview-empty">
              <span class="material-symbols-outlined" style="font-size: 32px; opacity: 0.3;">image</span>
              <span>Scraped items will appear here...</span>
            </div>
          </div>
          <!-- JSON preview (hidden by default) -->
          <div id="live-preview-content" class="custom-scrollbar" style="
            display: none;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: 12px;
            font-family: 'JetBrains Mono', 'Monaco', monospace;
            font-size: 11px;
            color: var(--color-primary);
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
          ">// Data will appear here...</div>
        </div>

        <!-- Scheduled Tasks Table -->
        <div class="tasks-section" style="margin-top: 16px;">
          <div class="section-header" style="margin-bottom: 12px;">
            <h3
              style="font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--color-text-muted);">
              Scheduled Tasks</h3>
          </div>
          <div class="option-card" style="padding: 0; overflow: hidden;">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Task</th>
                  <th>Status</th>
                  <th>Frequency</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tasks-table-body">
                <tr>
                  <td colspan="4" class="empty-placeholder">No scheduled tasks</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Match Strategy Tab -->
      <div id="tab-match" class="tab-pane">
        <header class="section-header">
          <h2>Match Strategy</h2>
        </header>

        <div class="option-card">
          <h3>Pattern Matching</h3>
          <div class="option-row">
            <span>Match Tag Name</span>
            <label class="switch">
              <input type="checkbox" id="match-tag" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Match Classes</span>
            <label class="switch">
              <input type="checkbox" id="match-class" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Match ID</span>
            <label class="switch">
              <input type="checkbox" id="match-id">
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Match Data Attributes</span>
            <label class="switch">
              <input type="checkbox" id="match-data">
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="option-card">
          <h3>Auto-Scroll Configuration</h3>
          <div class="input-group">
            <label>Throttle Delay (ms)</label>
            <input type="number" id="scroll-speed" value="1000" min="100" max="10000">
          </div>
          <div class="input-group">
            <label>Max Items (0 = unlimited)</label>
            <input type="number" id="max-items" value="0" min="0">
          </div>
          <div class="input-group">
            <label>Retry Count</label>
            <input type="number" id="retry-count" value="3" min="1" max="10">
          </div>
        </div>
      </div>

      <!-- Extraction Tab -->
      <div id="tab-extract" class="tab-pane">
        <header class="section-header">
          <h2>Data Extraction</h2>
          <button id="add-field-btn" class="btn-icon-sm" title="Add Field">
            <span class="material-symbols-outlined" style="font-size: 18px;">add</span>
          </button>
        </header>

        <div class="option-card">
          <h3>Extraction Options</h3>
          <div class="option-row">
            <span>Preserve Hierarchy</span>
            <label class="switch">
              <input type="checkbox" id="preserve-hierarchy">
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Normalize Text</span>
            <label class="switch">
              <input type="checkbox" id="normalize-text" checked>
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="option-card">
          <h3>Custom Fields</h3>
          <div id="fields-list" class="scrolling-list custom-scrollbar">
            <div class="empty-placeholder">No custom fields defined</div>
          </div>
        </div>

        <div style="margin-top: 16px;">
          <div class="input-group" style="margin-bottom: 8px;">
            <label style="font-size: 12px; margin-bottom: 4px; display: block;">Export Format</label>
            <select id="export-format-selector" class="form-select" style="width: 100%; height: 36px;">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
              <option value="excel">Excel (.xlsx with Analysis)</option>
            </select>
          </div>
          <button id="export-btn" class="btn-primary">
            <span class="material-symbols-outlined">download</span>
            Export Data
          </button>
        </div>
      </div>

      <!-- History Tab -->
      <div id="tab-history" class="tab-pane">
        <header class="section-header">
          <h2>Run History</h2>
          <button id="clear-history-btn" class="btn-text">Clear All</button>
        </header>

        <div class="option-card" style="padding: 0; overflow: hidden;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Task</th>
                <th>Status</th>
                <th>Items</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody id="history-table-body">
              <tr>
                <td colspan="4" class="empty-placeholder">No history yet</td>
              </tr>
            </tbody>
          </table>
          <div class="pagination">
            <span class="pagination-info" id="history-pagination-info">Showing 0 of 0</span>
            <div class="pagination-buttons">
              <button class="pagination-btn" id="history-prev-btn" disabled>Previous</button>
              <button class="pagination-btn" id="history-next-btn" disabled>Next</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="tab-settings" class="tab-pane">
        <header class="section-header">
          <h2>Settings</h2>
        </header>

        <div class="option-card">
          <h3>General</h3>
          <div class="option-row">
            <span>Dark Mode</span>
            <label class="switch">
              <input type="checkbox" id="dark-mode" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Show Notifications</span>
            <label class="switch">
              <input type="checkbox" id="show-notifications" checked>
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="option-card">
          <h3>Export Defaults</h3>
          <div class="input-group">
            <label>Default Format</label>
            <select id="default-format" class="form-select" style="height: 40px;">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
              <option value="excel">Excel</option>
            </select>
          </div>
        </div>

        <div class="option-card">
          <h3>Webhooks & Integrations</h3>
          <div class="input-group">
            <label>Webhook URL</label>
            <input type="text" id="webhook-url" placeholder="https://your-webhook.com/endpoint">
          </div>
          <div class="option-row">
            <span>Send on task completion</span>
            <label class="switch">
              <input type="checkbox" id="webhook-on-complete">
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Send on task failure</span>
            <label class="switch">
              <input type="checkbox" id="webhook-on-failure" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="option-row">
            <span>Include extracted data</span>
            <label class="switch">
              <input type="checkbox" id="webhook-include-data">
              <span class="slider"></span>
            </label>
          </div>
          <div style="margin-top: 12px;">
            <button id="test-webhook-btn" class="btn-secondary" style="width: 100%;">
              <span class="material-symbols-outlined" style="font-size: 16px; margin-right: 4px;">send</span>
              Test Webhook
            </button>
          </div>
        </div>

        <div class="option-card">
          <h3>About</h3>
          <p style="font-size: 12px; color: var(--color-text-muted);">
            Scraper Pro v2.0<br>
            Built with Tailwind CSS
          </p>
        </div>
      </div>

    </main>
  </div>

  <!-- Task Creation Wizard Modal -->
  <div class="wizard-overlay" id="wizard-overlay">
    <div class="wizard-modal">
      <div class="wizard-sidebar">
        <div class="wizard-step active" data-step="1">
          <span class="wizard-step-number">1</span>
          <span>General</span>
        </div>
        <div class="wizard-step" data-step="2">
          <span class="wizard-step-number">2</span>
          <span>Schedule</span>
        </div>
        <div class="wizard-step" data-step="3">
          <span class="wizard-step-number">3</span>
          <span>Export</span>
        </div>
      </div>
      <div class="wizard-content">
        <!-- Step 1: General -->
        <div class="wizard-step-content active" id="wizard-step-1">
          <div class="wizard-header">
            <h2>General Setup</h2>
            <p>Configure the basic settings for your scraping task.</p>
          </div>
          <div class="wizard-body">
            <div class="form-field">
              <label class="form-label">Task Name</label>
              <input type="text" class="form-input" id="wizard-task-name" placeholder="My Scraping Task">
            </div>
            <div class="form-field">
              <label class="form-label">Target URL</label>
              <input type="text" class="form-input" id="wizard-target-url" placeholder="https://example.com">
            </div>
            <div class="form-field">
              <label class="form-label">Description (optional)</label>
              <textarea class="form-textarea" id="wizard-description" placeholder="What does this task do?"></textarea>
            </div>
          </div>
        </div>

        <!-- Step 2: Schedule -->
        <div class="wizard-step-content" id="wizard-step-2">
          <div class="wizard-header">
            <h2>Schedule</h2>
            <p>Set when and how often this task should run.</p>
          </div>
          <div class="wizard-body">
            <div class="form-field">
              <label class="form-label">Frequency</label>
              <select class="form-select" id="wizard-frequency">
                <option value="once">Run Once</option>
                <option value="hourly">Every Hour</option>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
              </select>
            </div>
            <div class="form-field">
              <label class="form-label">Max Items to Collect</label>
              <input type="number" class="form-input" id="wizard-max-items" value="100" min="1">
            </div>
            <div class="form-field">
              <label class="form-label">Timeout (seconds)</label>
              <input type="number" class="form-input" id="wizard-timeout" value="300" min="30">
            </div>
          </div>
        </div>

        <!-- Step 3: Export -->
        <div class="wizard-step-content" id="wizard-step-3">
          <div class="wizard-header">
            <h2>Export & Integration</h2>
            <p>Configure how data should be exported.</p>
          </div>
          <div class="wizard-body">
            <div class="form-field">
              <label class="form-label">Export Format</label>
              <select class="form-select" id="wizard-export-format">
                <option value="json">JSON</option>
                <option value="csv">CSV</option>
                <option value="excel">Excel</option>
              </select>
            </div>
            <div class="form-field">
              <label class="form-label">Webhook URL (optional)</label>
              <input type="text" class="form-input" id="wizard-webhook" placeholder="https://your-webhook.com/endpoint">
            </div>
            <div class="option-row" style="padding: 12px 0;">
              <span style="font-size: 14px;">Auto-export on completion</span>
              <label class="switch">
                <input type="checkbox" id="wizard-auto-export">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="wizard-footer">
          <button class="btn-secondary" id="wizard-cancel-btn">Cancel</button>
          <div style="display: flex; gap: 8px;">
            <button class="btn-secondary" id="wizard-prev-btn" style="display: none;">
              <span class="material-symbols-outlined" style="font-size: 16px;">arrow_back</span>
              Back
            </button>
            <button class="btn-primary" id="wizard-next-btn" style="width: auto; padding: 0 20px;">
              Next
              <span class="material-symbols-outlined" style="font-size: 16px;">arrow_forward</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./sidepanel.ts"></script>
</body>

</html>